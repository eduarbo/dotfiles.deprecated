#!/usr/bin/env zsh
source ${0:A:h}/../../deploy

# Dependencies

common_packages=(
  the_silver_searcher
  ripgrep
  sqlite
)

dnf_packages=(
  make
  emacs
)

install() {
  case $(_os) in
    macos)
      brew tap d12frosted/emacs-plus
      brew install emacs-plus --without-spacemacs-icon
      brew install ${common_packages[@]}
      ;;
    fedora)
      sudo dnf install -y ${common_packages[@]} ${dnf_packages[@]}
      ;;
  esac

  YES=1 make install
}

update() {
  cd ~/.emacs.d && YES=1 make update
  cd ~/.emacs.d/cask && git pull
}

link() {
  # Clone and setup my doom-emacs fork
  _ensure_repo eduarbo/doom-emacs ~/.emacs.d && \
    cd ~/.emacs.d && \
    git checkout develop

  # Clone Cask, Project management tool for Emacs
  _ensure_repo cask/cask ~/.emacs.d/cask

  mklink doom $XDG_CONFIG_HOME/
  mklink doom/init.el ~/.emacs.d/
}

clean() {
  rm -rfv "$XDG_CONFIG_HOME/doom" "~/.emacs.d"
}

init "$@"
